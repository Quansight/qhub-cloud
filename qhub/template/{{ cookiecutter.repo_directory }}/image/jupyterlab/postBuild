#!/usr/bin/env bash
set -euo pipefail

# install classic notebook extensions
jupyter nbextension enable --py widgetsnbextension --sys-prefix

# ====== setup ipython conifiguration ======
mkdir -p /etc/ipython
cp /opt/jupyterlab/ipython_config.py /etc/ipython/ipython_config.py

# ====== setup juypterlab configuration overrides ======
mkdir -p /opt/conda/share/jupyter/lab/settings
cp /opt/jupyterlab/overrides.json /opt/conda/share/jupyter/lab/settings

# ====== code-server install/config 
mkdir -p /opt/code_server
cd /opt/code_server
curl -fsSL https://code-server.dev/install.sh > install.sh
sh install.sh --prefix /opt/code_server

# ====== fix perms ======
fix-permissions /opt/conda /opt/jupyterlab /etc/ipython /opt/code_server
